---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/9/20 16:35
--累计充值item
local AddUpRechargeItem = class("AddUpRechargeItem");

--初始化
function AddUpRechargeItem:ctor(super, trans)
    self.transform = trans;
    self.data = {};
    self.cfg = {};
    self.itemBg = trans:Find("item_bg"):GetComponent("Image")--.onClick:AddListener(coroutine_cal(
    self.titleImg = trans:Find("title_img"):GetComponent("Image");
    self.titleTxt = trans:Find("title_txt"):GetComponent("Text");
    self.moneyTxt = trans:Find("title_txt/money_txt"):GetComponent("Text");
    self.getTxt = trans:Find("get_txt"):GetComponent("Text");
    self.goodsBg = trans:Find("goods_bg");
    self.btnClick = trans:Find("btn_click"):GetComponent("Button");
    self.getIsOver = trans:Find("get_is_over");
    self._dropItems = {}
    self.goodItemPrefab = trans:Find("goods_bg/viewport/content/good_item");
    self.content = trans:Find("goods_bg/viewport/content");
end

--设置数据(action:动画事件)
function AddUpRechargeItem:SetData(cfg,action)
    self.cfg = cfg;
    self.moneyTxt.text = cfg.price;
    for i = 1, #cfg.goods do
        if(self._dropItems[i] == nil)then
            if(i == 1)then
                self._dropItems[i] = Bag:CtorComSimpleGoodsUi(self.goodItemPrefab);
            else
                self._dropItems[i] = Bag:CtorComSimpleGoodsUi(CS.UnityEngine.GameObject.Instantiate(self.goodItemPrefab.gameObject,self.content));
            end
        end
        Bag:SetComSimpleGoodsUi(self._dropItems[i],cfg.goods[i][1],cfg.goods[i][2],cfg.goods[i][3])
    end
    if(Operation:GetMoney() >= cfg.price) then
        set_obj_active(self.getTxt.transform,true);
        if(self.data.moneygift[cfg.id] ~= nil)then
            self.btnClick.interactable = false;
            set_obj_active(self.getIsOver,true);
            self.titleImg.color = COLOR_TYPE.White;
            self.titleTxt.color = COLOR_TYPE.White;
            self.moneyTxt.color = COLOR_TYPE.White;
            set_obj_active(self.getTxt.transform,true);
            self.getTxt.color = COLOR_TYPE.Gray55;
            self.getTxt:SetTextById(99000007)
            self.itemBg.sprite = AtlasMgr:LoadAtlasSprite("source_atlas/atlas_operation", "Img_BG_leijichongzhi_Item_1")
        else
            self.btnClick.interactable = true;
            set_obj_active(self.getIsOver,false);
            self.titleImg.color = COLOR_TYPE.Black;
            self.titleTxt.color = COLOR_TYPE.Black;
            self.moneyTxt.color = COLOR_TYPE.Black;
            self.getTxt.color = COLOR_TYPE.White;
            self.getTxt:SetTextById(99000006);
            self.itemBg.sprite = AtlasMgr:LoadAtlasSprite("source_atlas/atlas_operation", "Img_BG_leijichongzhi_Item_2")
        end
    else
        self.btnClick.interactable = false;
        set_obj_active(self.getTxt.transform,false);
        set_obj_active(self.getIsOver,false);
        self.titleImg.color = COLOR_TYPE.White;
        self.titleTxt.color = COLOR_TYPE.White;
        self.moneyTxt.color = COLOR_TYPE.White;
        self.itemBg.sprite = AtlasMgr:LoadAtlasSprite("source_atlas/atlas_operation", "Img_BG_leijichongzhi_Item_1")
    end
    if(action ~= nil)then
        action(self.transform);
    end
end

--按钮监听添加
function AddUpRechargeItem:AddListener(back)
    self.btnClick.onClick:AddListener(function ()
        back(self.cfg.id);
    end);
end

--已领取
function AddUpRechargeItem:SetGetIsOver()
    set_obj_active(self.getIsOver,true);
    self.titleImg.color = COLOR_TYPE.White;
    self.titleTxt.color = COLOR_TYPE.White;
    self.moneyTxt.color = COLOR_TYPE.White;
    set_obj_active(self.getTxt.transform,true);
    self.getTxt.color = COLOR_TYPE.Gray55;
    self.getTxt:SetTextById(99000007)
    self.itemBg.sprite = AtlasMgr:LoadAtlasSprite("source_atlas/atlas_operation", "Img_BG_leijichongzhi_Item_1")
end

--隐藏Item
function AddUpRechargeItem:HideItem()
    set_obj_active(self.transform,false);
end

function AddUpRechargeItem:OnDestroy()
    self.transform = nil;
    self.data = nil;
    self.cfg = nil;
    self.itemBg = nil;
    self.titleImg = nil;
    self.titleTxt = nil;
    self.moneyTxt = nil;
    self.getTxt = nil;
    self.goodsBg = nil;
    self.btnClick = nil;
    self.getIsOver = nil;
end
return AddUpRechargeItem;