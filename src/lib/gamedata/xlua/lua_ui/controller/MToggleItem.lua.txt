---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/9/18 15:53
---

local MToggleItem = class("MToggleItem");

--初始化
function MToggleItem:ctor(super, trans)
    self.m_id = nil;
    self.transform = trans;
    self.curTime = 0;
    self.m_selectTxt = self.transform:GetTextComponent("select/txt_title");
    self.m_selectTxtE = self.transform:GetTextComponent("select/txt_title_E");
    self.m_unselectTxt = self.transform:GetTextComponent("unselect/txt_title");
    self.m_unselectTxtE = self.transform:GetTextComponent("unselect/txt_title_E");
    self.m_iconImg = self.transform:Find("img_icon");
    self.m_tog = self.transform:GetComponent("MToggle");
    self.m_redImg = self.transform:Find("red_img");
    self.m_countDownBg = self.transform:Find("count_down_bg");
    if(self.m_countDownBg ~= nil)then
        self.m_txtTime = self.m_countDownBg:Find("txt_time");
    end
    if(self.m_txtTime ~= nil)then
        self.m_txtTime = self.m_txtTime:GetComponent("Text");
    end
    if(self.m_iconImg ~= nil)then
        self.m_iconImg = self.m_iconImg:GetComponent("Image");
    end
end

function MToggleItem:AddAction(action)
    self._action = action;
end


--设置Item数据data = {id = "数据ID",name = "按钮名称",nameE = "按钮英文名称",imgPath = "图片路径",timer = "时间ID" }
function MToggleItem:SetData(data)
    set_obj_active(self.transform,true);
    self.m_data = data;
    self.m_id = data.id;
    self.m_timer = data.timer;
    self.m_selectTxt.text = data.name;
    if(self.m_selectTxtE ~= nil)then
        self.m_selectTxtE.text = data.nameE;
    end
    self.m_unselectTxt.text = data.name;
    if(self.m_unselectTxtE ~= nil)then
        self.m_unselectTxtE.text = data.nameE;
    end
    if(data.timer ~= nil)then
        if(data.timer > 0)then
            self.curTime = CTime:GetRemainTime(data.timer);
        end
    end
    if(self.m_iconImg ~= nil)then
        self.m_selectSprite = AssetLoader:LoadSprite(data.imgPath .."_c");
        self.m_unSelectSprite = AssetLoader:LoadSprite(data.imgPath .."_a");
        self:SetIconImage(false);
    end
    if(self._action ~= nil)then
        self._action(self.transform);
    end
    self:UpdateTime();
end


function MToggleItem:UpdateTime()
    if(self.m_timer == nil)then
        return;
    end
    if(self.m_timer > 0)then
        self.curTime = CTime:GetRemainTime(self.m_timer)
        if(self.m_countDownBg ~= nil)then
            set_obj_active(self.m_countDownBg,true);
        end
        if(self.m_txtTime ~= nil)then
            if(self.curTime > 0)then
                self.m_txtTime.text = CTime:Time2Str_2(self.curTime);
            else
                self.m_txtTime:SetTextById(90086);
            end
        end
    else
        if(self.m_countDownBg ~= nil)then
            set_obj_active(self.m_countDownBg,false);
        end
    end
end

--添加tog点击事件
function MToggleItem:AddListener(back)
    self.m_tog.onValueChanged:AddListener(function (isOn)
        self:SetIconImage(isOn);
        back(self.m_id,isOn);
    end);
end

function MToggleItem:SetIconImage(isOn)
    if(self.m_iconImg ~= nil)then
        if(isOn)then
            if(self.m_iconImg.sprite ~= self.m_selectSprite)then
                self.m_iconImg.sprite = self.m_selectSprite;
            end
        else
            if(self.m_iconImg.sprite ~= self.m_unSelectSprite)then
                self.m_iconImg.sprite = self.m_unSelectSprite;
            end
        end
    end
end

function MToggleItem:SetRedImg(isShow)
    if(self.m_redImg ~= nil)then
        set_obj_active(self.m_redImg,isShow);
    end
end

function MToggleItem:HideItem()
    set_obj_active(self.transform,false);
end

function MToggleItem:OnDestroy()
    self.m_id = nil;
    self.transform = nil;
    self.m_selectTxt = nil;
    self.m_selectTxtE = nil;
    self.m_unselectTxt = nil;
    self.m_unselectTxtE = nil;
    self.m_iconImg = nil;
    self.m_tog = nil;
    self.m_redImg = nil;
end
return MToggleItem;