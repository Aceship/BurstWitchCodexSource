---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/9/6 11:44
---
local CBaseLayer = core.require("xlua/lua_UI/UIBaseLayer.txt")
local UserAgreementLayer = class("UserAgreementLayer", CBaseLayer)
--按钮
local BTNS = {
    btnOk = "container/button_ok",
}
--构造函数
function UserAgreementLayer:ctor(super)
    CBaseLayer.ctor(self)
    self._prefab = {
        path = "prefab_uiLogin/ui_LoginPanel/UI_UserAgreementLayer",
    }
    self:onEnter()
end

--进入Ui调用一次
function UserAgreementLayer:onEnter()
    self:createPnl();
    self:registerButtonEvent(BTNS);
    self:Init();
end

function UserAgreementLayer:onExit()
    self.btnOk = nil
    self.togRead = nil
    self.callback = nil
    self.contentView = nil
    self._shadow = nil
    CBaseLayer.onExit(self)
end

--按钮事件
function UserAgreementLayer:onButtonClick(itype)
    if(itype == BTNS.btnOk)then
        self:OnBtnOkClick();
    end
end

--退出按钮事件
function UserAgreementLayer:onBackClick()
    if(self.callback ~= nil)then
        self.callback();
    end
    self:onPopLayer();
end

--初始化
function UserAgreementLayer:Init()
    self.btnOk = self.layer:GetButtonComponent(BTNS.btnOk)
    self.btnOk.interactable = false;
    self.togRead = self.layer:GetToggleComponent("container/tog_read")
    self.togRead.isOn = false;
    self.togRead.onValueChanged:AddListener(
        function(isOn)
            self:OnTogReadClick(isOn)
        end)
    self.contentView = self.layer:GetScrollRectComponent("container/content_view")
    self.contentView.vertical = false;
    self._aniPanelFadeInEndCallback = function()
        self.contentView.vertical = true;
    end
    self._shadow = self.layer:Get("container/btn_shadow")
end

--显示UI
function UserAgreementLayer:show(isNew,callback)
    self:showLayer();
    self.isNew = isNew;
    self.callback = callback;
    self:InitUI();
end

--初始化
function UserAgreementLayer:InitUI()
    if(self.isNew)then
        self.togRead.transform:SetVisible(true);
        self.btnOk.interactable = false;
    else
        self.togRead.transform:SetVisible(false);
        self.btnOk.interactable = true;
    end

    if  self.btnOk.interactable then
        self._shadow:SetVisible(false)
    else
        self._shadow:SetVisible(true)
    end
    self.layer:GetTextComponent("container/text_title").text = Language:GetTxtBuyId(10460001)
    self.layer:GetTextComponent("container/content_view/view_port/content").text = string.gsub(Language:GetTxtBuyId(10460002), "\\n", "\n");
end

function UserAgreementLayer:OnTogReadClick(isOn)
    self.btnOk.interactable = isOn;
    if(isOn)then
        self._shadow:SetVisible(false)
    else
        self._shadow:SetVisible(true)
    end
end

function UserAgreementLayer:OnBtnOkClick()
    if(self.isNew)then
        Groble_SceneMgr:PrefsSetString("isNewInstall", "isNewInstall")
    end
    self:onBackClick();
end

return UserAgreementLayer;
